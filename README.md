# WhatsApp ‚Üî Gupshup ‚Üî amoCRM MVP

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ WhatsApp —á–µ—Ä–µ–∑ Gupshup API —Å amoCRM. –ü–æ–∑–≤–æ–ª—è–µ—Ç:

- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ WhatsApp —á–µ—Ä–µ–∑ Gupshup API
- ‚úÖ –ü–æ–ª—É—á–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ webhook
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏ —Å–¥–µ–ª–∫–∏ –≤ amoCRM
- ‚úÖ –î–æ–±–∞–≤–ª—è—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è –≤ amoCRM
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ amoCRM –≤ WhatsApp

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ –∏–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç
cd whatsapp-amo-mvp

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env —Ñ–∞–π–ª (—Å–º. –Ω–∏–∂–µ)
cp .env.example .env
nano .env
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —Ñ–∞–π–ª–µ `.env`:

```env
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
NODE_ENV=production
PORT=3001

# Gupshup WhatsApp API
GUPSHUP_API_KEY=–≤–∞—à_api_key_–∏–∑_gupshup
GUPSHUP_APP_NAME=–∏–º—è_–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è_gupshup
GUPSHUP_SOURCE_NUMBER=–≤–∞—à_whatsapp_–Ω–æ–º–µ—Ä

# amoCRM API
AMO_SUBDOMAIN=–≤–∞—à_–ø–æ–¥–¥–æ–º–µ–Ω_amocrm
AMO_CLIENT_ID=client_id_–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
AMO_CLIENT_SECRET=client_secret_–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
AMO_REDIRECT_URI=http://www.bondio.ru/api/amo/callback
```

### 3. –ó–∞–ø—É—Å–∫

```bash
# –û–±—ã—á–Ω—ã–π –∑–∞–ø—É—Å–∫
npm start

# –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
npm run dev

# –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ PM2 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
npm run pm2
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Gupshup

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [gupshup.io](https://www.gupshup.io)
2. –°–æ–∑–¥–∞–π—Ç–µ WhatsApp Business –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö webhook —É–∫–∞–∂–∏—Ç–µ: `http://www.bondio.ru/webhook/gupshup`
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ API Key –∏ –∏–º—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ `.env`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ amoCRM

1. –í amoCRM –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
2. –°–æ–∑–¥–∞–π—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
3. –ü–æ–ª—É—á–∏—Ç–µ Client ID –∏ Client Secret
4. –£–∫–∞–∂–∏—Ç–µ Redirect URI: `http://www.bondio.ru/api/amo/callback`
5. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ `.env`
6. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å: –æ—Ç–∫—Ä–æ–π—Ç–µ `http://www.bondio.ru/api/amo/auth`

## üì° API Endpoints

### –û—Å–Ω–æ–≤–Ω—ã–µ

- `GET /health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
- `GET /` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ –∏ endpoints

### –°–æ–æ–±—â–µ–Ω–∏—è

- `POST /api/send-message` - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
  ```json
  {
    "phone": "+79001234567",
    "message": "–ü—Ä–∏–≤–µ—Ç!"
  }
  ```

- `GET /api/dialog/:phone` - –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å –Ω–æ–º–µ—Ä–æ–º
- `GET /api/dialogs` - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–∏–∞–ª–æ–≥–æ–≤

### amoCRM

- `GET /api/amo/auth` - –ù–∞—á–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é OAuth
- `GET /api/amo/callback` - Callback –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
- `POST /api/amo/send-from-crm` - –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑ amoCRM
  ```json
  {
    "phone": "+79001234567",
    "message": "–°–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ amoCRM",
    "contactId": 12345,
    "leadId": 67890
  }
  ```

### Webhook

- `POST /webhook/gupshup` - Webhook –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç Gupshup

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –í—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
1. –ö–ª–∏–µ–Ω—Ç –ø–∏—à–µ—Ç –≤ WhatsApp
2. Gupshup –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –Ω–∞ `/webhook/gupshup`
3. –°–µ—Ä–≤–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
4. –°–æ–∑–¥–∞–µ—Ç—Å—è/–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–æ–Ω—Ç–∞–∫—Ç –≤ amoCRM
5. –°–æ–∑–¥–∞–µ—Ç—Å—è —Å–¥–µ–ª–∫–∞ (–µ—Å–ª–∏ –Ω–µ—Ç)
6. –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ —Å —Ç–µ–∫—Å—Ç–æ–º —Å–æ–æ–±—â–µ–Ω–∏—è

### –ò—Å—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
1. –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ API `/api/send-message`
2. –ò–ª–∏ –∏–∑ amoCRM —á–µ—Ä–µ–∑ `/api/amo/send-from-crm`
3. –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Gupshup API
4. –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞
5. –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ –≤ amoCRM

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
curl http://www.bondio.ru/health

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
curl -X POST http://www.bondio.ru/api/send-message \
  -H "Content-Type: application/json" \
  -d '{"phone":"+79001234567","message":"–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"}'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤
curl http://www.bondio.ru/api/dialogs
```

### –õ–æ–≥–∏

–í—Å–µ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å:
- ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚ùå –û—à–∏–±–∫–∏ —Å –¥–µ—Ç–∞–ª—è–º–∏
- üì§üì• –í—Ö–æ–¥—è—â–∏–µ –∏ –∏—Å—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

### –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**1. "Gupshup API –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `GUPSHUP_API_KEY` –∏ `GUPSHUP_APP_NAME` –≤ `.env`

**2. "–¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"**
- –ü—Ä–æ–π–¥–∏—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ `/api/amo/auth`

**3. "Webhook –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è"**
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL webhook –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Gupshup

**4. –°–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –¥–æ—Ö–æ–¥—è—Ç**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å WhatsApp –Ω–æ–º–µ—Ä–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—å opt-in (—Å–æ–≥–ª–∞—Å–∏–ª—Å—è –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
whatsapp-amo-mvp/
‚îú‚îÄ‚îÄ server.js           # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ gupshup.js     # API Gupshup WhatsApp
‚îÇ   ‚îî‚îÄ‚îÄ amo.js         # API amoCRM
‚îú‚îÄ‚îÄ package.json        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Node.js
‚îú‚îÄ‚îÄ .env               # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å!)
‚îî‚îÄ‚îÄ README.md          # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:**

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ firewall
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ API
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ .env –≤ git

## üìà –†–∞–∑–≤–∏—Ç–∏–µ

–°–ª–µ–¥—É—é—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –ø—Ä–æ–µ–∫—Ç–∞:

- [ ] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
- [ ] –û—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–µ–¥–∏–∞ —Ñ–∞–π–ª–æ–≤
- [ ] –®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
- [ ] –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
- [ ] Chatbot —Ñ—É–Ω–∫—Ü–∏–∏

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–∫ —Ö–æ—Ç–∏—Ç–µ!

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `.env` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å webhook URL
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å –≤ `/health`

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ

–ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `npm start` –∏ –Ω–∞—á–∏–Ω–∞–π—Ç–µ –æ–±—â–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ WhatsApp ‚Üî amoCRM
