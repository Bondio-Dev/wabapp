# Makefile –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–º —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º –º–µ–Ω—é üöÄ

.PHONY: help down up build rebuild logs clean push

# –¶–≤–µ—Ç–∞ –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
GREEN = \033[0;32m
YELLOW = \033[0;33m
BLUE = \033[0;34m
NC = \033[0m # No Color

help:
	@printf "\n${YELLOW}–î–û–°–¢–£–ü–ù–´–ï –ö–û–ú–ê–ù–î–´:${NC}\n\n"
	@printf "${GREEN}1.${NC} üõë  –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (—Å —É–¥–∞–ª–µ–Ω–∏–µ–º)\n"
	@printf "${GREEN}2.${NC} üöÄ  –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã\n"
	@printf "${GREEN}3.${NC} üî®  –¢–æ–ª—å–∫–æ —Å–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (—Å –∫—ç—à–µ–º)\n"
	@printf "${GREEN}4.${NC} ‚ôªÔ∏è  –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ (–æ—á–∏—Å—Ç–∫–∞ + —Å–±–æ—Ä–∫–∞ + –∑–∞–ø—É—Å–∫)\n"
	@printf "${GREEN}5.${NC} üìú  –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤\n"
	@printf "${GREEN}6.${NC} üßπ  –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, volumes, –æ–±—Ä–∞–∑—ã)\n"
	@printf "${GREEN}7.${NC} üìå  Git: –î–æ–±–∞–≤–∏—Ç—å, –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏ –∑–∞–ø—É—à–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è\n"
	@printf "${GREEN}0.${NC} ‚ùå  –í—ã—Ö–æ–¥\n\n"
	@printf "${BLUE}–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ (–≤–≤–µ–¥–∏—Ç–µ —Ü–∏—Ñ—Ä—É):${NC} " && read choice; \
	case "$$choice" in \
		1) make down;; \
		2) make up;; \
		3) make build;; \
		4) make rebuild;; \
		5) make logs;; \
		6) make clean;; \
		7) make push;; \
		0) printf "\nüëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!\n";; \
		*) printf "\n‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞\n"; make help;; \
	esac

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º
down:
	@printf "\n${YELLOW}üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã...${NC}\n"
	docker compose down --remove-orphans
	@printf "\n${GREEN}‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —É—Å–ø–µ—à–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ —É–¥–∞–ª–µ–Ω—ã!${NC}\n"

# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
up:
	@printf "\n${YELLOW}üöÄ –ó–∞–ø—É—Å–∫–∞—é —Å–±–æ—Ä–∫—É –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤...${NC}\n"
	docker compose up -d --build
	@printf "\n${GREEN}‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å–æ–±—Ä–∞–Ω—ã –∏ –∑–∞–ø—É—â–µ–Ω—ã!${NC}\n"

# –¢–æ–ª—å–∫–æ —Å–±–æ—Ä–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫—ç—à–∞
build:
	@printf "\n${YELLOW}üî® –°–æ–±–∏—Ä–∞—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (—Å –∫—ç—à–µ–º)...${NC}\n"
	docker compose build --no-cache
	@printf "\n${GREEN}‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!${NC}\n"

# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞
rebuild: down build up
	@printf "\n${GREEN}‚ôªÔ∏è  –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!${NC}\n"

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
logs:
	@printf "\n${YELLOW}üìú –û—Ç–∫—Ä—ã–≤–∞—é –ª–æ–≥–∏...${NC}\n"
	docker compose logs -f

# –û—á–∏—Å—Ç–∫–∞
clean:
	@printf "\n${YELLOW}üßπ –í—ã–ø–æ–ª–Ω—è—é –ø–æ–ª–Ω—É—é –æ—á–∏—Å—Ç–∫—É...${NC}\n"
	docker compose down -v --rmi all --remove-orphans
	docker system prune -a -f
	@printf "\n${GREEN}‚úÖ –°–∏—Å—Ç–µ–º–∞ –æ—á–∏—â–µ–Ω–∞!${NC}\n"

# Git: –î–æ–±–∞–≤–∏—Ç—å, –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏ –∑–∞–ø—É—à–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
push:
	@printf "\n${YELLOW}üìå –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞—é git-–∫–æ–º–º–∏—Ç...${NC}\n"
	git add .
	git commit -m "Auto-commit: $$(date +'%Y-%m-%d %H:%M:%S')" || (printf "\n${YELLOW}‚ö†Ô∏è  –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞${NC}\n" && exit 0)
	git push
	@printf "\n${GREEN}‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä!${NC}\n"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ
install:
	chmod +x $(shell pwd)/Makefile
	@printf "\n${GREEN}‚úÖ Makefile –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!${NC}\n"